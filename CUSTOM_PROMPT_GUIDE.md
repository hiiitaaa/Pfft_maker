# 📝 自作プロンプト機能ガイド

## 🎯 概要

**自作プロンプト機能**を使うと、自分で作成したプロンプトを保存・管理・再利用できます。

---

## 💾 現在の保存方法

### **方法1: シーンエディタから保存（既存機能）**

```
1. シーンエディタでブロックを作成（「✏️ ブロック追加」または既存ブロック）
2. 保存したいブロックを選択
3. 「💾 ライブラリに保存」ボタンをクリック
4. ダイアログで以下を入力：
   ├ 日本語ラベル（必須）: "服の上から愛撫"
   ├ 英語ラベル（オプション）: "touching over clothes"
   ├ カテゴリ: "自作" または任意のカテゴリ
   ├ タグ: "愛撫,服装付き,clothed"（自動生成も可）
   └ メモ: "特によく使うプロンプト"
5. 「保存」をクリック
→ data/custom_prompts.json に保存されます
```

### **保存される情報**
- **プロンプト本体**: "1girl, touching over clothes, ..."
- **日本語ラベル**: "服の上から愛撫"
- **英語ラベル**: "touching over clothes"
- **カテゴリ**: "自作" または任意
- **タグ**: 検索用（自動生成または手動）
- **メモ**: 補足情報
- **使用履歴**: 使用回数、最終使用日時、使用プロジェクト

---

## 📂 保存場所

```
E:\tool\Pfft_maker\
└── data/
    └── custom_prompts.json  ← ここに保存
```

**JSONフォーマット**:
```json
{
  "custom_prompts": [
    {
      "id": "custom_001",
      "prompt": "1girl, touching over clothes, ...",
      "label_ja": "服の上から愛撫",
      "label_en": "touching over clothes",
      "category": "自作",
      "tags": ["愛撫", "服装付き", "clothed"],
      "created_date": "2025-01-14T12:34:56",
      "last_used": "2025-01-14T14:20:10",
      "usage_count": 5,
      "used_in_projects": ["プロジェクト1", "プロジェクト2"],
      "notes": "特によく使うプロンプト"
    }
  ]
}
```

---

## 🔍 使用方法（現状の問題点）

### **❌ 現在の問題**
1. **保存したプロンプトがライブラリパネルに表示されない**
   - 内部では読み込まれているが、UIに表示されていない
   - ユーザーが保存後に見つけられない

2. **直接追加する方法がない**
   - シーンエディタ経由でしか保存できない
   - 手間がかかる

3. **管理機能が不足**
   - 編集・削除がしにくい
   - よく使うプロンプトが分からない

---

## ✨ 改善提案

### **提案1: ライブラリパネルに自作プロンプトを表示**

```
プロンプトライブラリ
├── 全て (10,942件)
├── 行為 (1,234件)
├── 背景 (567件)
├── ...
└── ✨ 自作プロンプト (15件)  ← 追加！
    ├── 服の上から愛撫 (使用: 5回)
    ├── 学園制服 (使用: 3回)
    └── カスタムポーズ (使用: 1回)
```

**ダブルクリックで挿入可能**:
- 固定テキストとして挿入
- シーンエディタで即利用

### **提案2: 「+ 新規プロンプト追加」ボタン**

```
┌────────────────────────────────────┐
│ プロンプトライブラリ                │
├────────────────────────────────────┤
│ カテゴリ: [全て        ▼]          │
│ [検索...                        ]  │
│                                    │
│ [ライブラリを読み込み] [同期]      │
│ [🤖 ラベル一括生成]                │
│ [➕ 新規プロンプト追加]  ← 追加！   │
│                                    │
│ ツリー表示...                       │
└────────────────────────────────────┘
```

**クリックすると**:
- CustomPromptDialogが直接開く
- プロンプトを入力して即座に保存
- シーンエディタを経由しない

### **提案3: 右クリックメニューで管理**

```
自作プロンプトを右クリック:
├── 📄 挿入
├── ✏️ 編集
├── 🗑️ 削除
├── 📋 プロンプトをコピー
└── ℹ️ 詳細表示
```

### **提案4: 統計表示**

```
✨ 自作プロンプト (15件)
├── 📊 よく使うプロンプト
│   ├── 服の上から愛撫 (使用: 5回)
│   ├── 学園制服 (使用: 3回)
│   └── カスタムポーズ (使用: 1回)
└── 🕒 最近使ったプロンプト
    ├── カスタムポーズ (5分前)
    ├── 学園制服 (1時間前)
    └── 服の上から愛撫 (昨日)
```

---

## 🎨 UI改善案（具体的）

### **ライブラリパネル更新後のイメージ**

```
┌─────────────────────────────────────────┐
│ プロンプトライブラリ                     │
├─────────────────────────────────────────┤
│ カテゴリ: [全て              ▼]         │
│ [検索...                              ] │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [ライブラリを読み込み] [同期]       │ │
│ │ [🤖 ラベル一括生成]                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ [➕ 新規プロンプト追加]              │ │ ← 追加
│ │ [📂 自作プロンプトを管理]           │ │ ← 追加
│ └─────────────────────────────────────┘ │
│                                         │
│ ツリー:                                  │
│ ▼ 全て (10,942件)                       │
│   ▼ 行為 (1,234件)                      │
│     └ [FILE] act/touch.txt              │
│         └ 愛撫                           │
│   ▼ ✨ 自作プロンプト (15件)  ← 追加    │
│     ├ 服の上から愛撫 (📌5回)           │
│     ├ 学園制服 (📌3回)                  │
│     └ カスタムポーズ (📌1回)            │
│                                         │
│ ステータス: 自作15件 / 全体10,942件     │
└─────────────────────────────────────────┘
```

---

## 📋 実装計画

### **Phase 1: 表示機能（優先度: 高）**
- [x] CustomPromptManagerの読み込み（既存）
- [ ] ツリーに「✨ 自作プロンプト」カテゴリを追加
- [ ] 自作プロンプトをツリーに表示
- [ ] ダブルクリックで挿入

### **Phase 2: 追加機能（優先度: 高）**
- [ ] 「➕ 新規プロンプト追加」ボタン
- [ ] ボタンクリックでCustomPromptDialog表示
- [ ] 保存後に自動更新

### **Phase 3: 管理機能（優先度: 中）**
- [ ] 右クリックメニュー（編集・削除）
- [ ] よく使うプロンプト表示
- [ ] 最近使ったプロンプト表示

### **Phase 4: 高度な機能（優先度: 低）**
- [ ] カテゴリ別管理
- [ ] エクスポート/インポート
- [ ] プロンプトプレビュー

---

## 🚀 すぐに使える改善

### **今すぐできること**
1. **手動でJSONを確認**:
   ```
   data/custom_prompts.json を開いて確認
   ```

2. **保存されたプロンプトを手動でコピー**:
   - JSONからプロンプト本体をコピー
   - 「✏️ ブロック追加」で貼り付け

3. **テンプレート機能と組み合わせ**:
   - よく使うプロンプトをブロックに配置
   - 「テンプレートとして保存」で再利用

---

## 🎯 ユーザー体験の改善

### **Before（現状）**
```
1. ブロックを作成
2. 「💾 ライブラリに保存」
3. 保存完了！
4. ...でも、どこに保存された？🤔
5. どうやって使う？🤔
```

### **After（改善後）**
```
1. ブロックを作成
2. 「💾 ライブラリに保存」
3. 保存完了！
4. ライブラリパネルの「✨ 自作プロンプト」に即座に表示
5. ダブルクリックで再利用！✨
```

または

```
1. 「➕ 新規プロンプト追加」ボタンをクリック
2. プロンプトを入力・貼り付け
3. 保存
4. 即座に利用可能！✨
```

---

## 🔧 次のステップ

どの改善案を実装しますか？

1. **Phase 1: 表示機能を実装**（約30分）
   - ライブラリパネルに自作プロンプトを表示

2. **Phase 2: 追加ボタンを実装**（約20分）
   - 「➕ 新規プロンプト追加」ボタン

3. **Phase 3: 管理機能を実装**（約1時間）
   - 右クリックメニュー、よく使うプロンプト

4. **全部実装**（約2時間）
   - 完全な自作プロンプト管理システム

---

## 💡 推奨

**Phase 1 + Phase 2を実装**することをお勧めします。

これにより：
- 保存したプロンプトが見える
- 直接追加できる
- 使いやすくなる

**すぐに実装しましょうか？**
