# 問題10: テンプレート機能の実用性検討 - 解決記録

作成日: 2025-10-12
問題番号: 10
ステータス: ✅ 解決済み

---

## 問題の概要

**タイトル**: テンプレート機能の「個別プロンプト内容」オプションの実用性

**問題内容**:
FR-013のテンプレート機能において、「☐ 個別プロンプト内容（オプション）」のチェックを外すと、ブロック構造だけが保存され、空のブロックが並んでしまう。これでは実用性が低く、使いづらい。

**該当箇所**:
- requirements.md: FR-013（テンプレート機能）

---

## 問題の詳細

### 現状の仕様（修正前）

```markdown
**保存内容**:
- ☑ シーン構成（30シーン）
- ☑ 使用ブロック構造
- ☑ 共通プロンプト（品質タグ等）
- ☐ 個別プロンプト内容（オプション）
```

**問題点**:
- 「個別プロンプト内容」のチェックを外すと、空のブロックだけが並ぶ
- 空のブロックだけでは、何を入れるべきか分からない
- 結果として、テンプレートとしての価値が低い

---

## 採用した解決策

**2種類のテンプレートを明確に区別**

### 1. 構成テンプレート（プレースホルダー方式）

**保存内容**:
- シーン数
- ブロック構造（ブロック数とタイプ）
- 共通プロンプト設定
- プロンプト内容は保存しない（空）

**用途**: プロジェクトの構造だけを再利用

**動作例**:
```
テンプレート適用後:
シーン1:
  [空の固定ブロック]    ← ユーザーが埋める
  [BREAK]
  [空のワイルドカードブロック]  ← ユーザーが埋める
```

**メリット**:
- 毎回異なる内容のプロジェクトに使える
- 構造だけを再利用、柔軟性が高い

---

### 2. 完全テンプレート（コピー方式）

**保存内容**:
- シーン数
- ブロック構造
- 共通プロンプト設定
- プロンプト内容も含めてすべて

**用途**: よく使うプロジェクト構成を完全にコピー

**動作例**:
```
テンプレート適用後:
シーン1:
  [clothed masturbation]  ← そのまま使える
  [BREAK]
  [__posing/arm__]        ← そのまま使える
```

**メリット**:
- すぐに使える
- 似たプロジェクトを量産する際に効率的
- 微調整のみで完成

---

## 実施した変更

### requirements.md FR-013の全面改訂

**変更内容**:

1. **テンプレートの種類を2つに明確化**
   - 構成テンプレート（プレースホルダー方式）
   - 完全テンプレート（コピー方式）

2. **それぞれの用途を明記**
   - 構成: プロジェクトの構造だけを再利用
   - 完全: プロジェクト全体をコピー

3. **動作例を追加**
   - 各テンプレート適用後の状態を具体的に記載

4. **UI仕様を更新**
   - テンプレートタイプをラジオボタンで選択
   - チェックボックス方式から変更

---

## UI仕様

### テンプレート保存ダイアログ

```
┌─ テンプレート保存 ─────────────────┐
│ テンプレート名:                    │
│ [学園メイド基本構成______]         │
│                                    │
│ テンプレートタイプ:                │
│ ◉ 構成テンプレート                 │
│   （プロンプト内容は保存しない）   │
│ ○ 完全テンプレート                 │
│   （プロンプト内容も含めて保存）   │
│                                    │
│ 説明（オプション）:                │
│ ┌────────────────────────────────┐ │
│ │30シーン構成、品質タグ統一      │ │
│ └────────────────────────────────┘ │
│                                    │
│          [キャンセル] [保存]       │
└────────────────────────────────────┘
```

**変更点**:
- チェックボックス → ラジオボタン（2択）
- テンプレートタイプの説明を追加

---

## 実装への影響

### テンプレートファイル形式

**構成テンプレート（.pfft_template）**:
```json
{
  "template_type": "structure",
  "template_name": "学園メイド基本構成",
  "scene_count": 30,
  "common_prompts": {
    "quality": "masterpiece, best quality",
    "lora": "<lora:futoshi_v1:0.7>"
  },
  "scene_structure": [
    {
      "blocks": [
        {"type": "fixed_text", "content": ""},  // 空
        {"type": "break"},
        {"type": "wildcard", "content": ""},    // 空
        {"type": "break"},
        {"type": "fixed_text", "content": ""}   // 空
      ]
    }
  ]
}
```

**完全テンプレート（.pfft_template）**:
```json
{
  "template_type": "complete",
  "template_name": "学園メイド完全版",
  "scene_count": 30,
  "common_prompts": {
    "quality": "masterpiece, best quality",
    "lora": "<lora:futoshi_v1:0.7>"
  },
  "scene_structure": [
    {
      "blocks": [
        {"type": "fixed_text", "content": "clothed masturbation"},
        {"type": "break"},
        {"type": "wildcard", "content": "__posing/arm__"},
        {"type": "break"},
        {"type": "fixed_text", "content": "masterpiece, best quality"}
      ]
    }
  ]
}
```

---

## 影響範囲

### 更新されたファイル
1. `requirements.md` (FR-013)

### 新規作成されたファイル
- `ISSUE_10_RESOLVED.md` （本ファイル）

### 影響を受ける機能
- FR-013: テンプレート機能
- UI: テンプレート保存ダイアログ、テンプレート選択ダイアログ

---

## テスト項目

### 単体テスト
- [ ] 構成テンプレートを保存した際、プロンプト内容が空になることを確認
- [ ] 完全テンプレートを保存した際、プロンプト内容も含まれることを確認
- [ ] 構成テンプレートを適用した際、空のブロックが生成されることを確認
- [ ] 完全テンプレートを適用した際、プロンプト内容も含めてコピーされることを確認

### 統合テスト
- [ ] テンプレート保存→読み込みで整合性が保たれることを確認
- [ ] 2種類のテンプレートがUI上で明確に区別されることを確認

### UI/UXテスト
- [ ] テンプレートタイプの選択がラジオボタンで分かりやすいことを確認
- [ ] 構成テンプレート適用後、ユーザーが内容を埋めやすいUIになっていることを確認
- [ ] 完全テンプレート適用後、すぐに使える状態になっていることを確認

---

## 補足事項

### なぜ2種類に分けたのか？

**従来の問題**:
- チェックボックス方式では、「個別プロンプト内容」を外すと空のブロックだけが並ぶ
- 空のブロックだけでは何を入れるべきか分からず、実用性が低い

**解決策**:
- テンプレートの用途を2つに明確化
- 構成: 構造だけを再利用（柔軟性重視）
- 完全: 内容も含めてコピー（効率性重視）

### ユースケース

**構成テンプレートの使用例**:
```
1. 「CG集基本構成」テンプレートを作成
   - 30シーン
   - 各シーンに固定→BREAK→ワイルドカード→BREAK→固定の構造

2. 新作「学園メイド」プロジェクトで構成テンプレートを適用
   - 30シーンの空のブロックが生成される
   - ユーザーが内容を埋める（行為、背景、キャラなど）

3. 新作「OL物語」プロジェクトでも同じテンプレートを適用
   - 構造は同じだが、内容は全く異なる
```

**完全テンプレートの使用例**:
```
1. 「学園メイドCG集」を完成させる

2. 「学園メイドCG集」を完全テンプレートとして保存

3. 続編「学園メイドCG集2」を作成
   - 完全テンプレートを適用
   - 30シーンの内容も含めてコピーされる
   - キャラ名や一部の行為だけを変更
   - 効率的に続編を制作
```

### 将来的な拡張可能性

もし将来的に、より高度なテンプレート機能が必要になった場合、以下のような拡張が可能:

**3. 部分テンプレート**:
- 特定のシーンだけをテンプレート化
- 例: 「保健室シーン」テンプレート（3シーン分）

**4. スマートテンプレート**:
- プレースホルダーに型情報を付与
- 例: `[行為を入れる]`, `[背景を入れる]`, `[キャラを入れる]`
- ユーザーに何を入れるべきか明示

ただし、これらは**Phase 1では実装しない**。

---

## 結論

問題10は**2種類のテンプレートを明確に区別**することで解決した。

**キーポイント**:
- ✅ 構成テンプレート: 構造だけを再利用（柔軟性重視）
- ✅ 完全テンプレート: 内容も含めてコピー（効率性重視）
- ✅ UI上でラジオボタンで明確に選択
- ✅ 実用性が大幅に向上

**次のステップ**:
- 問題12（AIコスト見積もり修正）へ進む
- 問題8（ファイル監視の照合ロジック改善）は**オプション**なので、Phase 2以降に延期

---

**承認日**: 2025-10-12
**承認者**: ユーザー
