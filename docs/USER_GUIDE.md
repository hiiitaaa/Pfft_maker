# Pfft_maker ユーザーガイド

バージョン: 1.0
最終更新: 2025-10-15
対象: Pfft_makerを使用するすべてのユーザー

---

## 📖 目次

1. [概要](#概要)
2. [初回起動フロー](#初回起動フロー)
3. [基本ワークフロー](#基本ワークフロー)
4. [30シーン作成フロー](#30シーン作成フロー)
5. [テンプレート機能](#テンプレート機能)
6. [自作プロンプトライブラリ](#自作プロンプトライブラリ)
7. [プロジェクトライブラリ](#プロジェクトライブラリ)
8. [シーンライブラリ](#シーンライブラリ)
9. [LoRAライブラリ](#loraライブラリ)
10. [プロンプト出力とStable Diffusion連携](#プロンプト出力とstable-diffusion連携)
11. [効率化テクニック](#効率化テクニック)
12. [トラブルシューティング](#トラブルシューティング)

---

## 概要

Pfft_makerは、Stable Diffusion WebUIの「Prompts from file or textbox」機能を効率的に使用するためのプロンプト管理ツールです。

### 主な特徴

- **10,942プロンプトを一元管理**: ワイルドカードファイルを読み込み、日本語ラベルで検索
- **3カラムUI**: 探す→組み立てる→確認の直感的なレイアウト
- **30シーン管理**: CG集制作に最適化されたシーン管理機能
- **テンプレート機能**: よく使うプロジェクト構成を保存・再利用
- **シーンライブラリ**: よく使うシーンを保存して別プロジェクトで再利用
- **LoRAライブラリ**: LoRAファイルを自動スキャン、メタデータ管理（NEW!）
- **AI連携**: Claude APIによる自動ラベル生成（オプション）

### 全体フロー図

```
┌─────────────┐
│ 起動        │
│ ライブラリ  │
│ 読み込み    │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────────┐
│ プロジェクト準備                │
│ • 新規作成                      │
│ • テンプレートから作成          │
│ • 既存プロジェクトを開く        │
└──────┬──────────────────────────┘
       │
       ▼
┌─────────────────────────────────┐
│ シーン作成（最大30回）          │
│  ┌──────────────────────────┐  │
│  │ 探す → 挿入 → 確認       │  │
│  │ ↓                        │  │
│  │ 次のシーンへ             │  │
│  └──────────────────────────┘  │
└──────┬──────────────────────────┘
       │
       ▼
┌─────────────────────────────────┐
│ 保存・出力                      │
│ • プロジェクト保存              │
│ • テンプレート保存              │
│ • プロンプト出力                │
└──────┬──────────────────────────┘
       │
       ▼
┌─────────────────────────────────┐
│ Stable Diffusion WebUI          │
│ → 画像生成                      │
└─────────────────────────────────┘
```

---

## 初回起動フロー

### STEP 1: アプリケーション起動

#### EXE版を使う場合（推奨）

配布されたZIPファイルを解凍し、`Pfft_maker.exe` をダブルクリックします。

```
Pfft_maker/
├── Pfft_maker.exe  ← これをダブルクリック
├── _internal/
└── ...
```

#### 開発環境版を使う場合

```bash
# Windowsバッチファイルで起動
Pfft_maker.bat

# または直接実行
python run.py
```

**起動時の自動処理:**
- ログシステムの初期化
- 設定ファイルの読み込み（`%APPDATA%\Pfft_maker\settings.json`）
- ワイルドカードファイルの更新チェック
- 新規プロジェクトの自動作成
- 自動バックアップ（24時間間隔、初回起動以外）

**データ保存先:**
- **通常モード**: `%APPDATA%\Pfft_maker`
  - Windows標準のアプリケーションデータフォルダ
  - アンインストールしてもデータは残ります
- **ポータブルモード**: `[EXE実行フォルダ]\user_data`
  - EXE実行フォルダに `PORTABLE.txt` を作成すると有効化
  - USBメモリなどでの持ち運びに便利

### STEP 1.5: ウェルカムダイアログ（初回起動時のみ）

初回起動時は、自動的に**ウェルカムダイアログ**が表示されます。

```
┌─────────────────────────────────┐
│ Pfft_makerへようこそ！          │
│                                 │
│ 初回セットアップを行います。    │
│                                 │
│ ワイルドカードフォルダ:         │
│ [参照...]                       │
│                                 │
│ データ保存先:                   │
│ C:\Users\[ユーザー名]\AppData\  │
│ Roaming\Pfft_maker              │
│                                 │
│ [スキップ] [OK]                 │
└─────────────────────────────────┘
```

**設定項目:**
- **ワイルドカードフォルダ**: Stable Diffusion WebUIのワイルドカードフォルダを選択
  - 例: `[SD WebUIフォルダ]\extensions\sd-dynamic-prompts\wildcards\`
- **データ保存先**: 自動表示（変更不可）

**操作:**
- **[OK]**: 設定を保存して続行
- **[スキップ]**: 後で設定（メニュー → ツール → 設定から変更可能）

### STEP 2: ライブラリ読み込み

左パネルの「ライブラリを読み込み」ボタンをクリックします。

**処理内容:**
1. `E:\EasyReforge\Model\wildcards\` からファイルを読み込み
2. 4種類のワイルドカード形式を自動認識
3. 10,942プロンプトをインデックス化（約1秒）
4. カテゴリ別に整理して表示

**読み込まれるカテゴリ例:**
- 📂 行為 (105件)
- 📂 背景 (62件)
- 📂 キャラ (4件)
- 📂 ポージング (25件)
- 📂 アングル (15件)
- 📂 自作 (12件)

### STEP 3: 更新通知の確認（必要時）

ワイルドカードファイルに更新があると、画面上部に通知バナーが表示されます。

```
┌────────────────────────────────────────┐
│ 📢 ライブラリに更新があります          │
│                                        │
│ 追加: 2ファイル、更新: 3ファイル、     │
│ 削除: 1ファイル                        │
│                                        │
│ [今すぐ同期] [後で]                    │
└────────────────────────────────────────┘
```

**バナーデザイン（2025-10-15改善）:**
- 背景色: ライトブルー（#E3F2FD）- 視認性重視
- 文字色: 黒（#000）、詳細テキスト: ダークグレー（#333）
- ボーダー: ブルー（#2196F3）

**操作:**
- **[今すぐ同期]**: ライブラリを再読み込み（ユーザーラベルは保持）
- **[後で]**: 通知を閉じる（次回起動時に再表示）

---

## 基本ワークフロー

### 3カラムレイアウト

```
┌────────────┐  ┌─────────────┐  ┌─────────────┐
│ 左パネル   │  │ 中央パネル  │  │ 右パネル    │
│ ライブラリ │→ │ シーン編集  │→ │ プレビュー  │
│  (600px)   │  │  (750px)    │  │  (550px)    │
└────────────┘  └─────────────┘  └─────────────┘
  探す・選択      組み立て          確認・出力
```

---

### 左パネル：プロンプトを探す

#### カテゴリから探す

```
┌─ ライブラリ ─────────────┐
│ 📂 カテゴリ一覧          │
│                          │
│ 📂 行為 (105)      [→]  │ ← クリック
│ 📂 背景 (62)       [→]  │
│ 📂 キャラ (4)      [→]  │
└──────────────────────────┘
```

**操作:**
1. カテゴリをクリック → ファイル一覧を表示
2. ファイルをクリック → プロンプト一覧を展開

#### 検索機能

```
🔍 [検索バー]
```

**検索対象:**
- 日本語ラベル（`label_ja`）
- 英語ラベル（`label_en`）
- プロンプト本文（`prompt`）
- タグ（`tags`）
- ファイル名（`source_file`）

**検索例:**
| キーワード | 結果 |
|-----------|------|
| `教室` | 背景/学校.txt → "教室" のプロンプト |
| `座る` | posing/sitting.txt → 座りポーズ候補 |
| `メイド` | キャラ/MAID.txt → メイドキャラ |
| `恥ずかし` | 表情/embarrassed.txt → 恥ずかしい表情 |

**リアルタイム検索:**
- 入力後300ms待機してから検索実行（デバウンス処理）
- 大文字小文字を区別しない

#### プロンプト表示形式

```
┌─ ライブラリ：行為 ──────────────┐
│ ◀ カテゴリ一覧                  │
│ 🔍 [検索...]  📁[tipo_play ▼]   │
│─────────────────────────────────│
│ 📁 tipo_play.txt (90)      [+]  │ ← ファイル全体
│                                 │
│   ├ 1. ({torogao|aheg... [+]   │ ← 個別プロンプト
│   ├ 14. clothed mast... [+]    │
│   ├ 25. deepthroat...   [+]    │
│   └ ...                         │
└─────────────────────────────────┘
```

**視覚的な区別:**
- **ファイル行**: 📁アイコン + 太字 + プロンプト総数
- **プロンプト行**: インデント + 番号 + プレビュー

---

### 中央パネル：シーンを組み立てる

```
┌─ シーン編集 ────────────────┐
│ シーン: [1:保健室 ▼]        │
│                              │
│ [ブロック1] 📌固定           │
│ clothed masturbation         │
│ [編集][削][↑][↓]           │
│                              │
│ [BREAK]                      │
│ [削][↑][↓]                 │
│                              │
│ [ブロック2] 🎲ワイルド       │
│ __posing/arm__               │
│ [編集][削][↑][↓]           │
│                              │
│ [+ブロック] [+BREAK]         │
│ [💾 ライブラリに保存]        │
└──────────────────────────────┘
```

#### プロンプト挿入方法

| 操作 | 結果 | 用途 |
|------|------|------|
| **個別プロンプトをダブルクリック** | 📌 固定テキストとして挿入<br>`clothed masturbation` | 必ずこのプロンプトを使いたい時 |
| **ファイル名の [+] をクリック** | 🎲 ワイルドカードとして挿入<br>`__tipo_play__` | ランダムに選びたい時 |
| **[+BREAK] ボタン** | BREAK区切りを追加 | プロンプトブロックを分割 |

#### ブロック編集操作

**並び替え:**
- **[↑] ボタン**: ブロックを上に移動
- **[↓] ボタン**: ブロックを下に移動
- **ドラッグ&ドロップ**: マウスで直接移動

**編集・削除:**
- **[編集] ボタン**: ブロック内容を編集
- **[削] ボタン**: ブロックを削除
- **右クリックメニュー**: 複製・移動・削除

#### BREAKの役割

**BREAKとは:**
- Stable Diffusionの75トークンチャンク境界を強制
- 前のプロンプトの文脈の影響を区切る

**使用例:**
```
キャラ設定, BREAK, 表情・ポーズ, BREAK, 背景・環境, BREAK, 品質タグ
```

**バリデーションルール:**
- ❌ 連続BREAK不可（`BREAK, BREAK`）
- ✅ 最初にBREAK可
- ✅ 最後にBREAK可

---

### 右パネル：プレビューで確認（2025-10-15改善）

```
┌─ プレビュー ────────────────┐
│ 【保存されたシーンのプレビュー】│
│                              │
│ ━━━ シーン1 ━━━            │
│ clothed masturbation,        │
│ BREAK,                       │
│ __posing/arm__,              │
│ BREAK,                       │
│ masterpiece, best quality    │
│                              │
│ ━━━ シーン2 ━━━            │
│ deepthroat, ...              │
│                              │
│ 文字数: 3450 (30シーン)      │
│ [コピー] [ファイル出力]      │ ← NEW!
└──────────────────────────────┘
```

#### プレビュー機能

**表示内容:**
- 「🖼️ シーンを保存（プレビューへ表示）」で保存されたシーンを表示
- シーンヘッダー（━━━ シーン1 ━━━）付きで表示
- 全シーンが一覧表示される

**最終プロンプト表示:**
- カンマ区切りで1行表示
- BREAK処理済み
- ワイルドカード形式（`__filename__`）はそのまま

**出力機能（2025-10-15追加）:**

1. **[コピー] ボタン:**
   - シーンヘッダーを自動削除
   - 1シーン1行、改行区切りで出力
   - Prompts from file or textbox形式に準拠

   ```
   【コピーされる形式】
   clothed masturbation, BREAK, __posing/arm__, BREAK, masterpiece, best quality
   deepthroat, classroom interior, BREAK, __posing/leg__, BREAK, best quality
   exhibitionism, school rooftop, BREAK, standing, BREAK, amazing quality
   ```

2. **[ファイル出力] ボタン:**
   - テキストファイルに保存
   - シーンヘッダーを自動削除
   - 1シーン1行、改行区切りで出力
   - Prompts from file or textbox形式に準拠

   ```
   【保存ダイアログ】
   ファイル名: prompts.txt
   保存先: ユーザー指定
   ```

**重要な変更点（2025-10-15）:**
- ✅ **明示的なプレビュー更新**: 「🖼️ シーンを保存（プレビューへ表示）」ボタンでのみ更新
- ✅ **ファイル出力機能追加**: コピーだけでなく、直接ファイルに出力可能
- ✅ **Prompts from file形式準拠**: シーンヘッダー削除、1シーン1行形式

---

## 30シーン作成フロー

### シーン管理の基本

```
シーン1: 保健室での診察
  ↓ Ctrl+→
シーン2: 教室での授業
  ↓ Ctrl+→
シーン3: 屋上での休憩
  ↓
...
  ↓
シーン30: エンディング
```

### シーン切り替え方法

| 操作 | 機能 |
|------|------|
| **Ctrl + →** | 次のシーンへ移動 |
| **Ctrl + ←** | 前のシーンへ移動 |
| **Ctrl + G** | シーン番号指定ジャンプ |
| **タブクリック** | 下部のシーン一覧タブから選択 |

### 効率的なシーン作成の流れ（2025-10-15改善版）

**新しいワークフロー:**
```
1. シーン名を入力
   作品名: [学園メイドCG集] [💾 作品を保存]  ← プロジェクト全体を保存
   シーン名: [保健室での診察]

2. プロンプト編集エリアでプロンプトを入力
   テキストエリア:
   ┌─────────────────────────┐
   │ clothed masturbation,   │
   │ school infirmary,        │
   │ BREAK,                   │
   │ __posing/sitting__,      │
   │ BREAK,                   │
   │ masterpiece, best quality│
   └─────────────────────────┘

3. [💾 シーンに保存] ボタンをクリック
   ↓
   プロンプト編集エリアの内容がシーンのブロックとして保存される

4. [🖼️ シーンを保存（プレビューへ表示）] ボタンをクリック
   ↓
   プレビューパネルに表示される

5. プレビューで確認
   - 文字数チェック (~500文字推奨)
   - ワイルドカード候補確認
   - [コピー] または [ファイル出力] で取り出し可能

6. Ctrl+→ で次のシーンへ
```

**重要な変更点（2025-10-15）:**
- ✅ **完成チェックボックスを削除**: 機能の重複を解消
- ✅ **プレビュー更新が明示的に**: "🖼️ シーンを保存（プレビューへ表示）"ボタンで明示的に更新
- ✅ **作品保存ボタン追加**: プロジェクト全体を"💾 作品を保存"ボタンで保存
- ✅ **ワークフローの明確化**: 編集 → シーンに保存 → プレビューへ表示の3ステップ

**シーン読み込み機能:**
```
[シーン読み込み] ボタンをクリック
   ↓
シーンライブラリから選択
   ↓
プロンプト編集エリアに直接読み込み（上書き確認あり）
   ↓
必要に応じて編集
   ↓
[💾 シーンに保存]
```

---

## テンプレート機能

### テンプレートとは

プロジェクト構成（シーン数・ブロック構造）を保存し、再利用できる機能です。

### テンプレートの種類

#### 1. 構成テンプレート（プレースホルダー方式）

**保存内容:**
- ✅ シーン数（例: 30シーン）
- ✅ ブロック構造（各シーンのブロック数とタイプ）
- ✅ 共通プロンプト設定
- ❌ プロンプト内容（空のまま）

**用途:**
- 毎回異なる内容のプロジェクトを作る時
- プロジェクトの構造だけを統一したい時

**適用後:**
```
シーン1:
  [空の固定ブロック]    ← 自分で埋める
  [BREAK]
  [空のワイルドブロック] ← 自分で埋める
  [BREAK]
  [空の固定ブロック]    ← 自分で埋める
```

#### 2. 完全テンプレート（コピー方式）

**保存内容:**
- ✅ シーン数
- ✅ ブロック構造
- ✅ 共通プロンプト設定
- ✅ プロンプト内容（すべて）

**用途:**
- 似たプロジェクトを量産する時
- ベースとなるプロンプトセットを再利用したい時

**適用後:**
```
シーン1:
  [clothed masturbation]  ← そのまま使える
  [BREAK]
  [__posing/arm__]        ← そのまま使える
  [BREAK]
  [masterpiece, best quality]
```

### テンプレート保存の流れ

```
1. メニュー → ファイル → テンプレートとして保存
   ↓
2. テンプレート保存ダイアログ
   ┌─────────────────────────┐
   │ テンプレート名:          │
   │ [学園メイド基本構成]     │
   │                          │
   │ タイプ:                  │
   │ ◉ 構成テンプレート       │
   │ ○ 完全テンプレート       │
   │                          │
   │ 説明:                    │
   │ [30シーン構成、品質統一] │
   │                          │
   │ [キャンセル] [保存]      │
   └─────────────────────────┘
   ↓
3. [保存] ボタンをクリック
   ↓
4. data/templates.json に保存完了
```

### テンプレートから作成

```
1. メニュー → ファイル → テンプレートから作成
   ↓
2. テンプレート選択ダイアログ
   ┌──────────────────────────┐
   │ 利用可能なテンプレート:  │
   │ ┌────────────────────────┐│
   │ │✨ 学園メイド基本構成   ││ ← 選択
   │ │  (構成テンプレート)    ││
   │ │  30シーン、10回使用    ││
   │ │                        ││
   │ │✨ CG集標準構成         ││
   │ │  (完全テンプレート)    ││
   │ │  20シーン、5回使用     ││
   │ └────────────────────────┘│
   │                          │
   │ プロジェクト名:          │
   │ [新規CG集プロジェクト]   │
   │                          │
   │ [編集] [削除]            │
   │                          │
   │ [キャンセル] [作成]      │
   └──────────────────────────┘
   ↓
3. [作成] ボタンをクリック
   ↓
4. 30シーンの骨組みが自動生成！
```

### テンプレート管理

**削除:**
1. テンプレート選択ダイアログで削除したいテンプレートを選択
2. [削除] ボタンをクリック
3. 確認ダイアログで [はい] を選択

**使用履歴:**
- 使用回数が自動記録される
- 最終使用日時が表示される

---

## 自作プロンプトライブラリ

### 概要

シーン編集中に作成したプロンプトを保存し、再利用できる機能です。

### プロンプト保存の流れ

```
1. シーン編集パネルでブロックを選択
   ↓
2. [💾 ライブラリに保存] ボタンをクリック
   ↓
3. 保存ダイアログ
   ┌─────────────────────────┐
   │ 日本語ラベル:            │
   │ [服の上から愛撫]         │
   │                          │
   │ カテゴリ:                │
   │ [行為 ▼]                 │
   │                          │
   │ タグ（自動生成）:        │
   │ [愛撫,服装付き,crotch... │
   │                          │
   │ [キャンセル] [保存]      │
   └─────────────────────────┘
   ↓
4. [保存] ボタンをクリック
   ↓
5. ライブラリの「自作」カテゴリに追加
```

### 保存されたプロンプトの使用

```
左パネル → 📂 自作 カテゴリ
   ↓
✨ 服の上から愛撫 [+]  ← ダブルクリック
   ↓
シーンに挿入！
```

### 使用履歴の記録

- 使用回数が自動記録
- 最終使用日時が記録
- よく使うプロンプトが分かる

---

## プロジェクトライブラリ

### 概要

**プロジェクトライブラリ**は、複数のシーンをまとめた「作品」を保存し、別のプロジェクトで再利用できる機能です。

**機能の違い:**
- **テンプレート**: プロジェクト構造（シーン数、ブロック構造）のみ保存
- **プロジェクトライブラリ**: 複数シーンの内容を丸ごと保存（完全なコピー）
- **シーンライブラリ**: 個別シーン（1シーン単位）を保存

### プロジェクトライブラリの利点

```
【従来の方法】
同じ作品セットを複数のプロジェクトで使いたい
→ 毎回シーンを1つずつコピー（時間がかかる）

【プロジェクトライブラリ使用】
よく使う作品セット（例: 30シーン）を一度保存
→ 別のプロジェクトで一括読み込み（数クリックで完了）
```

**よく使う作品セットの例:**
- "学園メイドCG集 基本30シーン"
- "温泉旅館シリーズ 20シーン"
- "日常系4コマ 10シーン"

### プロジェクトライブラリへの保存

```
1. メニュー → ファイル → プロジェクトライブラリに保存
   ↓
2. 保存ダイアログ
   ┌─────────────────────────┐
   │ 作品名:                  │
   │ [学園メイドCG集基本版]   │
   │                          │
   │ カテゴリ:                │
   │ [CG集 ▼]                 │
   │                          │
   │ タグ（カンマ区切り）:    │
   │ [学園, メイド, 30シーン] │
   │                          │
   │ 説明:                    │
   │ [学園を舞台にしたメイド  │
   │  シーンの基本セット]     │
   │                          │
   │ シーン数: 30             │
   │                          │
   │ [キャンセル] [保存]      │
   └─────────────────────────┘
   ↓
3. [保存] ボタンをクリック
   ↓
4. %APPDATA%\Pfft_maker\project_library.json に保存完了
```

### プロジェクトライブラリからの読み込み

```
1. メニュー → ファイル → プロジェクトライブラリから読み込み
   ↓
2. 選択ダイアログ
   ┌──────────────────────────────────┐
   │ 🔍 [検索...]                     │
   │                                  │
   │ 作品一覧      │  詳細情報        │
   │ ─────────────┼──────────────    │
   │ 学園メイドCG集│ 作品名:          │
   │ [CG集] (30シーン) 学園メイド...  │
   │ 使用: 5回    │                  │
   │              │ カテゴリ: CG集   │
   │ 温泉旅館20   │ シーン数: 30     │
   │ [CG集] (20シーン)                │
   │ 使用: 3回    │ タグ:            │
   │              │ 学園, メイド...  │
   │ [削除] [キャンセル] [読み込み]   │
   └──────────────────────────────────┘
   ↓
3. 作品を選択してダブルクリック or [読み込み]
   ↓
4. 読み込みオプション
   ┌─────────────────────────┐
   │ ◉ 新しいプロジェクトとして│
   │    作成                  │
   │ ○ 現在のプロジェクトに    │
   │    追加                  │
   │                          │
   │ [キャンセル] [OK]        │
   └─────────────────────────┘
   ↓
5. 30シーンが一気に読み込まれる！
```

### 検索・管理機能

**検索対象:**
- 作品名
- カテゴリ
- タグ
- 説明
- シーン名（含まれるシーン）

**使用履歴:**
- 使用回数が自動記録
- 最終使用日時が記録
- 使用したプロジェクト名も記録

**典型的なワークフロー:**
```
【作品セットの準備】
1. プロジェクト「学園メイドCG集 Vol.1」を完成
2. プロジェクトライブラリに保存（30シーン丸ごと）

【別の作品で再利用】
3. 新規プロジェクト「学園メイドCG集 Vol.2」を作成
4. プロジェクトライブラリから「学園メイドCG集基本版」を読み込み
5. 各シーンを少し編集（キャラ変更、背景変更など）
6. Ctrl+E でプロンプト出力
7. WebUIで一括生成
```

**データファイル:**
```
%APPDATA%\Pfft_maker/
└── project_library.json  ← プロジェクトライブラリの保存先
```

---

## シーンライブラリ

### 概要

**シーンライブラリ**は、よく使うシーン全体を保存し、別のプロジェクトで再利用できる機能です。

**機能の違い:**
- **プロジェクトライブラリ**: 複数シーンをまとめて保存（作品単位）
- **シーンライブラリ**: 個別シーン（1シーン単位）を保存

### シーンライブラリの利点

```
【従来の方法】
新しいプロジェクトのたびに、同じシーンを何度も作り直す
↓
【シーンライブラリ使用】
よく使うシーンを一度保存すれば、どのプロジェクトでも再利用可能
```

**よく使うシーンの例:**
- "学園廊下でのキス"
- "保健室でのシーン"
- "メイド服着替え"
- "教室での告白"

### UX改善機能（2025年10月実装）

シーンライブラリは以下のUX改善により、さらに使いやすくなりました：

#### 改善1: ワークフロー最適化（2025-10-15）

**新しいワークフロー:**
```
プロンプト編集エリアでシーンを作成
   ↓
[💾 シーンに保存] ← プロンプト編集エリアの内容を保存
   ↓
[🖼️ シーンを保存（プレビューへ表示）] ← プレビューパネルに表示
   ↓
プレビューで確認・出力
```

**変更内容:**
- ✅ **完成チェックボックスを削除**: 機能の重複を解消
- ✅ **明示的なプレビュー更新**: ボタンクリックで更新（自動更新は廃止）
- ✅ **作品保存ボタン追加**: プロジェクト全体を"💾 作品を保存"で保存
- ✅ **シーン読み込み機能改善**: プロンプト編集エリアに直接読み込み（新タブ作成ではなく）

**メリット:**
- ワークフローが明確化され、混乱が減少
- 保存機能が整理され、目的に応じた保存が可能
- プレビュー表示が意図した通りに動作

#### 改善2: カテゴリ編集機能（2025-10-15）

**機能:**
- シーンライブラリのカテゴリを編集可能に
- カテゴリの追加・削除・名前変更に対応
- カテゴリ選択フィールドに「編集」ボタンを追加

```
シーン保存ダイアログ
┌─────────────────────────┐
│ カテゴリ: [恋愛 ▼] [編集]│ ← NEW!
└─────────────────────────┘
   ↓
[編集] クリック
   ↓
カテゴリ編集ダイアログ
┌─────────────────────────┐
│ 📁 恋愛                  │
│ 📁 日常                  │
│ 📁 アクション            │
│                          │
│ [追加] [名前変更] [削除] │
└─────────────────────────┘
```

**メリット:**
- 自分好みのカテゴリ構成を作成可能
- プロジェクトに応じて柔軟に分類

#### 改善3: 一括保存機能（Ctrl+Shift+B）

30シーンを1つずつ保存するのは非効率！バッチ保存機能で一括処理できます。

```
メニュー → ツール → シーンを一括保存 (Ctrl+Shift+B)
   ↓
バッチ保存ダイアログ
┌──────────────────────────────┐
│ シーンを一括保存             │
│                              │
│ シーン一覧:                  │
│ ☑ 保健室での診察 (5ブロック)│
│ ☑ 教室での授業 (3ブロック)  │
│ ☑ 廊下でのキス (4ブロック)  │
│ ... (全30シーン)             │
│                              │
│ [全選択] [全解除]            │
│                              │
│ 保存先カテゴリ: [恋愛 ▼]    │
│ ☑ シーン名からタグを自動生成│
│                              │
│ [キャンセル] [一括保存]      │
└──────────────────────────────┘
   ↓
30シーンが一気にライブラリへ！
```

**メリット:**
- 30シーン保存が30回クリック → 1回の操作へ
- チェックボックスで選択的保存
- 共通カテゴリで整理が簡単
- タグ自動生成で検索性向上

#### 改善4: 🎬 シーンライブラリタブ（左パネル統合）（2025-10-14）

従来はボタンからダイアログを開く方式でしたが、左パネルに常設タブとして統合されました。

```
左パネル（ライブラリ）
┌─────────────────────┐
│ [ワイルドカード] [🎨LoRA] [✨自作] [🎬シーン] [📚作品]
├─────────────────────┤
│ ⭐ よく使うシーンTOP5│
│ ┌───────────────────┐│
│ │🎬 保健室診察 (10回)││ ← ダブルクリックで読み込み
│ │🎬 廊下キス (8回)   ││
│ │🎬 教室告白 (5回)   ││
│ └───────────────────┘│
│                      │
│ 🕒 最近使ったシーン  │
│ ┌───────────────────┐│
│ │🎬 保健室診察       ││
│ │   (10/15 15:30)   ││
│ │🎬 廊下キス         ││
│ │   (10/15 14:20)   ││
│ └───────────────────┘│
│                      │
│ 🔍 [検索...]        │
│                      │
│ 📁 全シーン一覧      │
│ ├ 📁 恋愛 (15)      │
│ │ ├ 🎬 保健室診察   │
│ │ ├ 🎬 廊下キス     │
│ │ └ ...             │
│ ├ 📁 日常 (8)       │
│ └ ...               │
└─────────────────────┘
```

**メリット:**
- 常に見える場所に配置（発見性UP）
- よく使うシーンTOP5にワンクリックアクセス
- 最近使ったシーンも一目瞭然
- カテゴリ別・検索機能で整理が簡単
- ダイアログを開く手間が不要

**注意（2025-10-15更新）:**
- ダブルクリックでプロンプト編集エリアに読み込み（上書き確認あり）
- 読み込み後、必要に応じて編集してから「💾 シーンに保存」

### シーン保存の流れ（テンプレートとして保存）

```
1. シーンエディタでシーンを作成
   プロンプト編集エリア:
   ┌─────────────────────────┐
   │ 1girl, school uniform,  │
   │ kiss, corridor,         │
   │ after school,           │
   │ BREAK,                   │
   │ __pose/kiss__           │
   └─────────────────────────┘
   ↓
2. [📚 シーンをテンプレート保存] ボタンをクリック
   ↓
3. 保存ダイアログ
   ┌─────────────────────────┐
   │ シーン名:                │
   │ [学園廊下でのキス]       │
   │                          │
   │ カテゴリ:                │
   │ [恋愛 ▼] [編集]         │ ← カテゴリ編集可能
   │                          │
   │ タグ（カンマ区切り）:    │
   │ [キス, 廊下, 学園, ...]  │
   │                          │
   │ 説明:                    │
   │ [学園の廊下で放課後に... │
   │  キスするシーン]         │
   │                          │
   │ [キャンセル] [保存]      │
   └─────────────────────────┘
   ↓
4. [保存] ボタンをクリック
   ↓
5. data/scene_library.json に保存完了
```

### シーン読み込みの流れ（2025-10-15改善）

**新しい動作: プロンプト編集エリアに直接読み込み**

```
1. [シーン読み込み] ボタンをクリック
   または
   左パネル「🎬シーンライブラリ」タブからダブルクリック
   ↓
2. シーン選択ダイアログ（ボタンの場合）
   ┌──────────────────────────────────┐
   │ 🔍 [検索...]                     │
   │                                  │
   │ シーンライブラリ  │  詳細情報    │
   │ ─────────────────┼──────────────│
   │ 学園廊下でのキス  │ シーン名:    │
   │ [恋愛] (使用: 5回)│ 学園廊下で...│
   │                   │              │
   │ メイド服着替え    │ カテゴリ:恋愛│
   │ [日常] (使用: 3回)│ ブロック数: 5│
   │                   │              │
   │ 教室での告白      │ タグ:        │
   │ [恋愛] (使用: 1回)│ キス, 廊下...│
   │                   │              │
   │ [削除] [キャンセル] [読み込み]   │
   └──────────────────────────────────┘
   ↓
3. シーンを選択してダブルクリック or [読み込み]
   ↓
4. 上書き確認（プロンプト編集エリアに内容がある場合）
   ┌─────────────────────────┐
   │ プロンプト編集エリアの  │
   │ 内容を上書きしますか？  │
   │                          │
   │ 現在の内容は失われます。│
   │                          │
   │ [キャンセル] [OK]        │
   └─────────────────────────┘
   ↓
5. プロンプト編集エリアに読み込み完了！
   ↓
6. 必要に応じて編集
   ↓
7. [💾 シーンに保存] → [🖼️ シーンを保存（プレビューへ表示）]
```

**重要な変更点:**
- ❌ **従来**: 新しいシーンタブを作成
- ✅ **新方式**: プロンプト編集エリアに直接読み込み（上書き確認あり）

### 検索機能

**検索対象:**
- シーン名
- カテゴリ
- タグ
- 説明

**検索例:**
```
🔍 キス       → "学園廊下でのキス" がヒット
🔍 学園       → "学園廊下でのキス" がヒット
🔍 メイド     → "メイド服着替え" がヒット
```

### 使用履歴の記録

シーンを挿入するたびに、以下が自動記録されます：

- **使用回数**: 何回使われたか
- **最終使用日時**: いつ最後に使ったか
- **使用プロジェクト**: どのプロジェクトで使ったか

**表示例:**
```
学園廊下でのキス [恋愛] (使用: 5回)
└ 使用プロジェクト: "学園恋愛物語", "メイド学園CG集", ...
```

### 典型的なワークフロー

#### パターンA: よく使うシーンを保存して再利用

```
【初回】プロジェクト「学園恋愛物語」
1. "学園廊下でのキス" シーンを作成
2. ブロックを追加・配置
3. [📚 シーンをライブラリに保存]
4. シーン名・カテゴリ・タグを入力して保存

【2回目以降】プロジェクト「メイド学園CG集」
1. [📚 ライブラリからシーンを挿入]
2. "学園廊下でのキス" を検索・選択
3. 挿入！
4. 少し編集（メイド要素を追加）
5. 完成！
```

#### パターンB: 複数のプロジェクトで同じシーンセットを使う

```
【シーンライブラリに保存】
- "朝の教室"
- "廊下でのすれ違い"
- "屋上での告白"
- "放課後のキス"

【新規プロジェクト作成】
1. プロジェクト: "学園恋愛物語"
2. ライブラリから "朝の教室" 挿入
3. ライブラリから "廊下でのすれ違い" 挿入
4. ライブラリから "屋上での告白" 挿入
5. ライブラリから "放課後のキス" 挿入
6. 各シーンを少し編集
7. Ctrl+E でプロンプト一括出力
8. WebUIで一括生成！
```

### データファイル

**保存場所:**
```
Pfft_maker/
└── data/
    └── scene_library.json  ← シーンライブラリの保存先
```

**ファイル形式:** JSON

```json
{
  "version": "1.0",
  "last_updated": "2025-10-14T15:30:00",
  "items": [
    {
      "id": "scene_lib_20251014153000_001",
      "name": "学園廊下でのキス",
      "description": "学園の廊下で放課後にキスするシーン",
      "category": "恋愛",
      "tags": ["キス", "廊下", "学園", "放課後"],
      "block_templates": [
        {
          "type": "fixed_text",
          "content": "1girl, school uniform, kiss"
        },
        {
          "type": "break",
          "content": ""
        },
        {
          "type": "wildcard",
          "content": "__pose/kiss__"
        }
      ],
      "created_date": "2025-10-14T15:30:00",
      "last_used": "2025-10-14T16:00:00",
      "usage_count": 5,
      "used_in_projects": ["学園恋愛物語", "メイド学園CG集"]
    }
  ]
}
```

---

## LoRAライブラリ

### 概要

**LoRAライブラリ**は、LoRAファイル（.safetensors）を自動的にスキャンし、メタデータを読み込んで管理する機能です。

**主な特徴:**
- `.safetensors`ファイルの自動検出
- Civitai.infoメタデータの自動読み込み
- トリガーワードと推奨重みの自動取得
- カテゴリ別表示（フォルダ構造を反映）
- `<lora:filename:0.8>`形式のプロンプト自動生成

### 初期設定

#### STEP 1: LoRAディレクトリを設定

```
メニュー → ツール → 設定
   ↓
設定ダイアログ
┌─────────────────────────────────┐
│ LoRAディレクトリ                │
│                                 │
│ LoRAフォルダ:                   │
│ [C:\sd-webui\models\Lora] [参照]│
└─────────────────────────────────┘
```

**例:**
- Stable Diffusion WebUI: `C:\stable-diffusion-webui\models\Lora`
- ComfyUI: `C:\ComfyUI\models\loras`

#### STEP 2: LoRAをスキャン

```
左パネル → 🎨LoRAタブ → [🔍 スキャン]
   ↓
プログレスダイアログ
┌─────────────────────────────────┐
│ LoRAファイルをスキャン中...     │
│ ████████░░░░░░░░░░ 42/100       │
│ Parsing: character/miku_v2.safetensors
└─────────────────────────────────┘
   ↓
完了！
┌─────────────────────────────────┐
│ スキャン完了                    │
│ 156件のLoRAファイルを検出       │
└─────────────────────────────────┘
```

**スキャン処理内容:**
1. LoRAフォルダ内の全`.safetensors`ファイルを検索
2. 各ファイルの`.civitai.info`と`.json`を読み込み
3. メタデータ（トリガーワード、重み、タグ）を抽出
4. `data/lora_library.csv`に保存

### 基本的な使い方

#### LoRAをプロンプトに挿入

```
左パネル → 🎨LoRAタブ
┌─────────────────────────────────┐
│ 🎨 LoRAライブラリ               │
│ [🔍 スキャン] [🔄 再読み込み]   │
│ 🔍 [検索...]                    │
│ カテゴリ: [全て ▼]              │
├─────────────────────────────────┤
│ 名前              │ プロンプト  │
├─────────────────────────────────┤
│ 初音ミク v2       │<lora:miku_v2:0.8>, hatsune miku
│ メイド服          │<lora:maid_outfit:0.7>, maid
│ 学園制服          │<lora:school_uniform:0.8>
└─────────────────────────────────┘
```

**操作:**
1. LoRAをダブルクリック
2. プロンプト編集エリアに自動挿入
   - 例: `<lora:miku_v2:0.8>, hatsune miku`

### メタデータの読み込み

#### Civitai.info ファイル

Civitaiからダウンロードした場合、自動的に`.civitai.info`ファイルが作成されます。

**読み込まれる情報:**
```json
{
  "trainedWords": ["hatsune miku", "twintails"],
  "baseModel": "SD 1.5",
  "model": {
    "name": "Hatsune Miku LoRA",
    "tags": ["anime", "character", "vocaloid"]
  }
}
```

**Pfft_makerでの表示:**
- **名前**: "Hatsune Miku LoRA"
- **トリガーワード**: "hatsune miku"
- **タグ**: anime, character, vocaloid
- **プロンプト**: `<lora:miku_v2:0.8>, hatsune miku`

#### JSONファイル

一部のLoRAには`.json`ファイルが同梱されています。

```json
{
  "activation text": "maid outfit, apron",
  "preferred weight": 0.7
}
```

**読み込み優先順位:**
1. `.civitai.info` （優先）
2. `.json` （補完）

### カテゴリとフォルダ構造

LoRAのフォルダ構造がそのままカテゴリとして反映されます。

```
C:\sd-webui\models\Lora/
├── character/
│   ├── miku_v2.safetensors        → カテゴリ: "LoRA/character"
│   └── rem_rezero.safetensors     → カテゴリ: "LoRA/character"
├── outfit/
│   ├── maid.safetensors           → カテゴリ: "LoRA/outfit"
│   └── school_uniform.safetensors → カテゴリ: "LoRA/outfit"
└── style/
    └── anime_style.safetensors    → カテゴリ: "LoRA/style"
```

**カテゴリフィルタ:**
```
カテゴリ: [LoRA/character ▼]
   ↓
characterフォルダのLoRAのみ表示
```

### 検索機能

#### 名前で検索

```
🔍 [miku]
   ↓
結果:
- Hatsune Miku LoRA
- Miku Append
```

#### タグで検索

```
🔍 [vocaloid]
   ↓
結果:
- Hatsune Miku LoRA (tags: vocaloid, character)
- Kagamine Rin (tags: vocaloid, character)
```

### データファイル

#### lora_library.csv

スキャン結果は`data/lora_library.csv`に保存されます。

```csv
id,source_file,label_ja,prompt,category,tags,lora_metadata
lora_miku_v2_1,character/miku_v2.safetensors,Hatsune Miku LoRA,"<lora:miku_v2:0.8>, hatsune miku",LoRA/character,"anime,character,vocaloid",{...}
```

**利点:**
- 次回起動時は即座に読み込み（スキャン不要）
- Excelで開いて確認・編集可能
- 手動でメタデータを追加可能

### 実践的な使用例

#### 例1: キャラクター生成

```
シーン: 初音ミクの立ち絵

プロンプト:
<lora:miku_v2:0.8>, hatsune miku, twintails, standing, full body
```

#### 例2: 複数LoRAの組み合わせ

```
シーン: メイド服を着た初音ミク

プロンプト:
<lora:miku_v2:0.8>, hatsune miku, <lora:maid_outfit:0.7>, maid, apron
```

#### 例3: スタイルLoRA

```
シーン: アニメ風の風景

プロンプト:
<lora:anime_style:0.6>, landscape, sky, clouds, sunset
```

### トラブルシューティング

#### LoRAが表示されない

**原因:**
- LoRAディレクトリが設定されていない
- `.safetensors`ファイルが存在しない

**解決策:**
1. 設定画面でLoRAディレクトリを確認
2. スキャンボタンを再実行
3. ログファイルでエラーを確認

#### メタデータが読み込まれない

**原因:**
- `.civitai.info`や`.json`ファイルが存在しない
- JSONファイルのフォーマットが不正

**解決策:**
1. Civitaiから再ダウンロード
2. 手動で`lora_library.csv`を編集
3. トリガーワードを手動で追加

#### スキャンに時間がかかる

**原因:**
- LoRAファイルが大量にある（100件以上）

**対策:**
- 初回スキャン後はCSVから読み込み（高速）
- 新しいLoRAを追加した時のみ再スキャン

---

## プロンプト出力とStable Diffusion連携

### プロンプト出力の流れ

```
1. メニュー → ファイル → プロンプト出力 (Ctrl+E)
   ↓
2. 出力設定ダイアログ
   ┌─────────────────────────┐
   │ 出力対象: 全30シーン     │
   │                          │
   │ 出力先:                  │
   │ ◉ ファイル               │
   │   ファイル名:            │
   │   [学園メイド_prompts.txt]│
   │   保存先:                │
   │   [E:\works\学園メイド\] │
   │   [参照...]              │
   │                          │
   │ ○ クリップボード         │
   │                          │
   │ オプション:              │
   │ ☑ 完成済みシーンのみ    │
   │ ☐ シーン番号をコメント  │
   │                          │
   │ [キャンセル] [出力]     │
   └─────────────────────────┘
   ↓
3. [出力] ボタンをクリック
   ↓
4. テキストファイル生成
```

### 出力形式

**Prompts from file形式:**
- 1行 = 1シーン = 1枚の画像生成
- カンマ区切り
- BREAK処理済み

**出力例:**
```
clothed masturbation, school infirmary, BREAK, __posing/arm__, BREAK, masterpiece, best quality
deepthroat, classroom interior, BREAK, __posing/leg__, BREAK, best quality
exhibitionism, school rooftop, BREAK, standing, BREAK, amazing quality
```

### Stable Diffusion WebUI連携

```
1. Stable Diffusion WebUI を起動
   ↓
2. Scripts → 「Prompts from file or textbox」を選択
   ↓
3. [参照] ボタンをクリック
   ↓
4. 出力したprompts.txtを選択
   ↓
5. [Generate] ボタンをクリック
   ↓
6. 30枚の画像が自動生成！
```

**ワイルドカードの展開:**
- Dynamic Prompts拡張が自動的にワイルドカードを展開
- `__posing/arm__` → ファイル内からランダムに1つ選択
- 毎回異なるバリエーションが生成される

---

## 効率化テクニック

### 1. 共通プロンプト設定の活用

```
メニュー → ツール → 設定
   ↓
共通プロンプトタブ
   ↓
品質タグ: [masterpiece, best quality, ...]
LoRA: [<lora:futoshi_v1:0.7>]
☑ 新規シーン作成時に自動挿入
   ↓
新規シーン作成時に自動で末尾に追加！
```

**メリット:**
- 毎回入力する手間を削減
- プロジェクト全体で品質を統一

### 2. 検索の高度な活用

**複数キーワード検索:**
```
🔍 メイド 教室  ← スペース区切りでAND検索
```

**カテゴリフィルタ併用:**
```
📁 [背景 ▼] + 🔍 学校  ← より絞り込み
```

### 3. キーボードショートカットの活用

| ショートカット | 機能 | 使用場面 |
|--------------|------|----------|
| `Ctrl+S` | 保存 | こまめな保存 |
| `Ctrl+E` | プロンプト出力 | 完成後の出力 |
| `Ctrl+Shift+B` | シーン一括保存 | 30シーンをまとめて保存 |
| `Ctrl+→` | 次のシーン | 高速シーン移動 |
| `Ctrl+←` | 前のシーン | シーン確認 |
| `Ctrl+N` | 新規プロジェクト | プロジェクト開始 |

### 4. プレビューパネルの活用

**文字数チェック:**
- 推奨: ~500文字
- 長すぎる場合: プロンプトを分割・削減

**ワイルドカード候補確認:**
- 意図しないプロンプトが含まれていないか確認
- 候補が少ない場合: ファイル全体（ワイルドカード）として挿入

### 5. テンプレートの効率的な使い方

**プロジェクトタイプ別のテンプレート:**
```
- 学園メイド基本構成（30シーン）
- 短編CG集構成（10シーン）
- LoRA比較用構成（5シーン×6キャラ）
```

**構成テンプレートの活用:**
- ベースの構造は共通
- 内容は毎回変える
- 一貫性を保ちつつ柔軟に対応

---

## トラブルシューティング

### ライブラリが読み込めない

**症状:**
- 「ライブラリを読み込み」ボタンをクリックしてもカテゴリが表示されない

**原因と対策:**

1. **ワイルドカードディレクトリが存在しない**
   ```
   対策: 設定でワイルドカードディレクトリのパスを確認
   デフォルト: E:\EasyReforge\Model\wildcards\
   ```

2. **ファイル形式が対応していない**
   ```
   対策: .txtファイルであることを確認
   対応形式: パターン1-4（詳細はrequirements.md参照）
   ```

3. **エンコーディングエラー**
   ```
   対策: UTF-8で保存されているか確認
   BOM付き/なし両対応
   ```

### プロンプトが正しく出力されない

**症状:**
- 出力したプロンプトファイルが期待と異なる

**原因と対策:**

1. **連続カンマが含まれる**
   ```
   原因: ブロックが空の場合に発生
   対策: プレビューパネルで確認し、空のブロックを削除
   ```

2. **BREAKの位置が不適切**
   ```
   原因: 連続BREAKがある
   対策: バリデーションエラーを確認し、修正
   ```

3. **ワイルドカード形式が正しくない**
   ```
   正しい: __posing/arm__
   誤り: __posing\arm__（バックスラッシュ）
   ```

### シーンが保存されない

**症状:**
- シーンを編集したが、プロジェクトに反映されない

**原因と対策:**

1. **自動保存が失敗している**
   ```
   対策: 手動保存（Ctrl+S）を実行
   ログファイルを確認:
     - EXE版: [EXE実行フォルダ]\logs\pfft_maker_YYYYMMDD.log
     - 開発環境: [プロジェクトフォルダ]\logs\pfft_maker_YYYYMMDD.log
   ```

2. **ネットワークドライブに保存している**
   ```
   対策: ローカルドライブに保存
   通知バナーのエラーメッセージを確認
   データフォルダ: %APPDATA%\Pfft_maker（通常は問題なし）
   ```

### テンプレートが作成できない

**症状:**
- テンプレート保存ダイアログで [保存] が押せない

**原因と対策:**

1. **テンプレート名が空**
   ```
   対策: テンプレート名を入力
   ```

2. **シーンが空**
   ```
   対策: 最低1シーンは作成してから保存
   ```

### アプリが起動しない

**症状:**
- Pfft_maker.batを実行してもウィンドウが表示されない

**原因と対策:**

1. **Python環境が正しくない**
   ```
   対策: Python 3.11以上がインストールされているか確認
   コマンド: python --version
   ```

2. **依存関係がインストールされていない**
   ```
   対策: pip install -r requirements.txt を実行
   ```

3. **ログを確認**
   ```
   場所:
     - EXE版: [EXE実行フォルダ]\logs\pfft_maker_YYYYMMDD.log
     - 開発環境: [プロジェクトフォルダ]\logs\pfft_maker_YYYYMMDD.log
   エラーメッセージを確認して対処
   ```

4. **データフォルダが見つからない**
   ```
   対策:
     - エクスプローラーのアドレスバーに %APPDATA%\Pfft_maker と入力
     - Enterキーで開く
   ```

---

## 付録

### データファイルの場所

**ユーザーデータフォルダ（通常モード）:**
```
%APPDATA%\Pfft_maker/
├── settings.json              # 設定ファイル
├── prompts_library.csv        # ライブラリデータ
├── labels_metadata.json       # ラベルメタデータ
├── templates.json             # テンプレート
├── custom_prompts.json        # 自作プロンプト
├── scene_library.json         # シーンライブラリ
├── project_library.json       # プロジェクトライブラリ（NEW!）
├── .api_keys.enc              # 暗号化されたAPIキー
├── .master_key                # マスターキー
└── backups/                   # 自動バックアップフォルダ
    ├── backup_20251015_120000/
    ├── backup_20251014_120000/
    └── ...
```

**実際のパス例:**
- Windows: `C:\Users\[ユーザー名]\AppData\Roaming\Pfft_maker\`

**ポータブルモード:**
```
[EXE実行フォルダ]/
├── Pfft_maker.exe
├── PORTABLE.txt               # これがあるとポータブルモード
└── user_data/                 # ユーザーデータ
    ├── settings.json
    ├── scene_library.json
    └── ...
```

**アプリケーションフォルダ（EXE版）:**
```
[EXE実行フォルダ]/
├── Pfft_maker.exe
├── _internal/                 # Pythonランタイムなど
├── data/                      # 配布データ
│   ├── prompts_library.csv    # 初期ライブラリデータ
│   └── settings.default.json  # デフォルト設定
└── logs/                      # ログファイル
    └── pfft_maker_20251015.log
```

**開発環境:**
```
Pfft_maker/
├── run.py
├── src/
├── data/                      # 開発用データ（非配布）
├── logs/                      # ログファイル
└── user_data/                 # ポータブルモード時のみ
```

**注意:**
- プロジェクトファイル（.pfft）は任意の場所に保存可能
- ワイルドカードフォルダは外部（Stable Diffusion WebUI）を参照

### プロジェクトファイルの構造

**ファイル形式:** JSON（`.pfft`）

```json
{
  "project_info": {
    "name": "学園メイドCG集",
    "created_date": "2025-10-14T10:00:00",
    "last_modified": "2025-10-14T15:30:00",
    "description": "保健室を舞台にしたメイド物"
  },
  "scenes": [
    {
      "scene_id": 1,
      "scene_name": "保健室での診察",
      "is_completed": true,
      "blocks": [...]
    }
  ],
  "common_prompts": [...],
  "metadata": {...}
}
```

### よく使うフォルダパス

| 用途 | パス |
|------|------|
| **ユーザーデータ** | `%APPDATA%\Pfft_maker\`<br>（通常モード） |
| **ユーザーデータ** | `[EXE実行フォルダ]\user_data\`<br>（ポータブルモード） |
| **ワイルドカード** | 設定で指定<br>（例: `[SD WebUIフォルダ]\extensions\sd-dynamic-prompts\wildcards\`） |
| **プロジェクト保存** | 任意のフォルダ（.pfftファイル） |
| **プロンプト出力** | 任意のフォルダ（.txtファイル） |
| **ログファイル** | `[EXE実行フォルダ]\logs\`（EXE版）<br>`[プロジェクトフォルダ]\logs\`（開発環境） |
| **バックアップ** | `%APPDATA%\Pfft_maker\backups\`<br>（通常モード） |

**パスの確認方法:**
1. エクスプローラーのアドレスバーに `%APPDATA%\Pfft_maker` と入力
2. Enterキーを押すとフォルダが開きます

---

## 関連ドキュメント

- [チュートリアル（初心者向け）](TUTORIAL.md)
- [機能要件定義書](../requirements.md)
- [技術要件定義書](../technical_requirements.md)
- [開発ガイド](archive/CLAUDE.md)

---

**ご不明な点がございましたら、Issue報告をお願いします:**
https://github.com/anthropics/pfft_maker/issues
