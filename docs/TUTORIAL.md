# Pfft_maker チュートリアル

**初めてのPfft_maker - ステップバイステップガイド**

このチュートリアルでは、Pfft_makerを初めて使う方向けに、インストールから画像生成までの流れを実際に操作しながら学びます。

---

## 📚 このチュートリアルで学べること

- ✅ Pfft_makerのインストールと初回起動
- ✅ 最初のシーンの作成
- ✅ プロンプトの探し方・挿入方法
- ✅ プロジェクトの保存
- ✅ プロンプトの出力
- ✅ Stable Diffusionでの画像生成

**所要時間:** 約30分

**前提条件:**
- Python 3.11以上がインストール済み
- Stable Diffusion WebUIがインストール済み
- Dynamic Prompts拡張がインストール済み

---

## Part 1: インストールと初回起動

### Step 1-1: 依存関係のインストール

コマンドプロンプトを開き、Pfft_makerのディレクトリに移動します。

```bash
cd E:\tool\Pfft_maker
```

依存関係をインストールします。

```bash
pip install -r requirements.txt
```

**確認:**
```bash
# インストール完了のメッセージが表示されればOK
Successfully installed PyQt6-6.6.1 pandas-2.1.4 ...
```

### Step 1-2: アプリケーションの起動

```bash
# Windowsバッチファイルで起動（推奨）
run_app.bat

# または直接実行
python run.py
```

**起動確認:**
- Pfft_makerのウィンドウが表示される
- 3カラム（左・中央・右）のレイアウトが見える
- タイトルバーに「Pfft_maker - 無題のプロジェクト」と表示される

### Step 1-3: ワイルドカードディレクトリの設定

初回起動時は、ワイルドカードファイルの場所を設定します。

1. メニュー → **ツール** → **設定**
2. **ワイルドカードディレクトリ**タブを選択
3. デフォルトパスを確認:
   ```
   E:\EasyReforge\Model\wildcards\
   ```
4. パスが異なる場合は [参照] ボタンで変更
5. [OK] ボタンをクリック

**確認:**
- 設定ダイアログが閉じる
- ステータスバーに「設定を保存しました」と表示

---

## Part 2: ライブラリの読み込み

### Step 2-1: ライブラリを読み込む

左パネルの上部にある **[ライブラリを読み込み]** ボタンをクリックします。

**処理中:**
```
読み込み中...
ファイルをスキャン中: 50/120
プロンプトをパース中: 5,000/10,942
```

**完了:**
```
ライブラリを読み込みました: 10,942プロンプト
```

### Step 2-2: カテゴリ一覧を確認

左パネルにカテゴリが表示されます。

```
┌─ ライブラリ ─────────────┐
│ 📂 カテゴリ一覧          │
│                          │
│ 📂 行為 (105)      [→]  │
│ 📂 背景 (62)       [→]  │
│ 📂 キャラ (4)      [→]  │
│ 📂 ポージング(25)  [→]  │
│ 📂 アングル (15)   [→]  │
│ 📂 自作 (0)        [→]  │
│                          │
│ 最近使用:                │
│ （まだありません）        │
└──────────────────────────┘
```

**確認ポイント:**
- カテゴリが表示されているか
- 各カテゴリの件数が表示されているか

---

## Part 3: 最初のシーンを作成

### Step 3-1: プロジェクト名を設定

まず、プロジェクトに名前を付けます。

1. メニュー → **ファイル** → **名前を付けて保存**
2. ファイル名を入力: `チュートリアルプロジェクト.pfft`
3. 保存場所を選択（例: `E:\works\tutorial\`）
4. [保存] ボタンをクリック

**確認:**
- タイトルバーが「Pfft_maker - チュートリアルプロジェクト.pfft」に変わる

### Step 3-2: シーン名を入力

中央パネルの上部にあるシーン名を変更します。

```
[1:シーン1 ▼] → [1:保健室での診察 ▼]
```

1. シーン名のドロップダウンをクリック
2. 「保健室での診察」と入力
3. Enterキーを押す

### Step 3-3: 最初のプロンプトを探す

#### 3-3-1: カテゴリから探す

左パネルで **📂 背景** をクリックします。

```
┌─ ライブラリ：背景 ───────┐
│ ◀ カテゴリ一覧           │
│ 🔍 [検索...]             │
│──────────────────────────│
│ 📁 学校.txt (15)    [+]  │
│ 📁 病院.txt (8)     [+]  │
│ 📁 街並み.txt (12)  [+]  │
│ ...                      │
└──────────────────────────┘
```

**📁 学校.txt** をクリックして展開します。

```
│ 📁 学校.txt (15)    [+]  │
│   ├ 1. 教室...      [+] │
│   ├ 2. 廊下...      [+] │
│   ├ 3. 保健室...    [+] │ ← これを使う
│   └ ...                  │
```

#### 3-3-2: プロンプトを挿入

**3. 保健室...** を**ダブルクリック**します。

**結果:**
中央パネルに固定テキストブロックが挿入されます。

```
┌─ シーン編集 ────────────┐
│ [ブロック1] 📌固定       │
│ school infirmary, beds  │
│ with curtain dividers   │
│ [編集][削][↑][↓]      │
└─────────────────────────┘
```

**確認:**
- 右パネルの「現在編集中のシーン」にプロンプトが表示される
- 文字数カウントが更新される

### Step 3-4: BREAKを追加

1. 中央パネルの **[+BREAK]** ボタンをクリック

**結果:**
```
┌─ シーン編集 ────────────┐
│ [ブロック1] 📌固定       │
│ school infirmary, beds  │
│ [編集][削][↑][↓]      │
│                         │
│ [BREAK]                 │ ← 追加された
│ [削][↑][↓]            │
└─────────────────────────┘
```

### Step 3-5: キャラクターを追加

#### 3-5-1: 検索を使う

左パネルの検索バーに **メイド** と入力します。

```
🔍 [メイド]
```

**検索結果:**
```
┌─ 検索結果：メイド ───────┐
│ 📁 キャラ/MAID.txt  [+]  │
│   ├ 1. メイド服...  [+] │
│   ├ 2. エプロン...  [+] │
│   └ ...                  │
└──────────────────────────┘
```

#### 3-5-2: ワイルドカードとして挿入

**📁 キャラ/MAID.txt** の **[+]** ボタンをクリックします。

**結果:**
ワイルドカードブロックが挿入されます。

```
┌─ シーン編集 ────────────┐
│ [ブロック1] 📌固定       │
│ school infirmary...     │
│ [編集][削][↑][↓]      │
│                         │
│ [BREAK]                 │
│ [削][↑][↓]            │
│                         │
│ [ブロック2] 🎲ワイルド   │ ← 追加された
│ __キャラ/MAID__          │
│ [編集][削][↑][↓]      │
└─────────────────────────┘
```

**ワイルドカードの意味:**
- `__キャラ/MAID__` = ファイル全体からランダムに1つ選択
- Stable Diffusion実行時に自動展開される

### Step 3-6: ポーズを追加

もう一度 **[+BREAK]** を追加してから、ポーズを探します。

1. 検索バーに **座る** と入力
2. **posing/sitting.txt** が表示される
3. 個別プロンプト **1. sitting on chair** を**ダブルクリック**

**結果:**
```
┌─ シーン編集 ────────────┐
│ [ブロック1] 📌固定       │
│ school infirmary...     │
│                         │
│ [BREAK]                 │
│                         │
│ [ブロック2] 🎲ワイルド   │
│ __キャラ/MAID__          │
│                         │
│ [BREAK]                 │
│                         │
│ [ブロック3] 📌固定       │ ← 追加された
│ sitting on chair        │
└─────────────────────────┘
```

### Step 3-7: 品質タグを追加

最後に品質タグを追加します。

1. **[+BREAK]** をクリック
2. 中央パネル下部の **[+ブロック]** ボタンをクリック
3. テキスト入力ダイアログが表示される
4. 以下を入力:
   ```
   masterpiece, best quality, amazing quality
   ```
5. [OK] ボタンをクリック

### Step 3-8: プレビューで確認

右パネルを確認します。

```
┌─ プレビュー ────────────┐
│ 【現在編集中のシーン】   │
│ school infirmary, beds   │
│ with curtain dividers,   │
│ BREAK,                   │
│ __キャラ/MAID__,          │
│ BREAK,                   │
│ sitting on chair,        │
│ BREAK,                   │
│ masterpiece, best quality│
│                          │
│ 文字数: 156 / ~500       │
│ [コピー] [このシーン出力]│
└──────────────────────────┘
```

**確認ポイント:**
- カンマ区切りになっているか
- BREAKの位置は適切か
- 文字数は推奨範囲内か（~500文字）

### Step 3-9: シーンを完成にする

中央パネルの **[☑ 完成]** チェックボックスにチェックを入れます。

```
[シーン: 1:保健室での診察 ▼] [☑ 完成]
```

**重要:**
完成にチェックを入れたシーンだけが出力対象になります。

---

## Part 4: 2つ目のシーンを作成

### Step 4-1: 次のシーンへ移動

**Ctrl + →** を押すか、下部のシーンタブで **[2]** をクリックします。

```
シーン一覧タブ:
[1:保健室 ✓] [2:シーン2 ★] [3] [4] ...
```

### Step 4-2: シーン2を作成

同様の手順で2つ目のシーンを作成します。

**例: 教室での授業**

1. シーン名: **教室での授業**
2. 背景: **教室** （個別プロンプト）
3. BREAK追加
4. キャラ: **__キャラ/MAID__** （ワイルドカード）
5. BREAK追加
6. ポーズ: **standing** （個別プロンプト）
7. BREAK追加
8. 品質タグ: **masterpiece, best quality**
9. [☑ 完成] チェック

**ショートカット活用:**
- **Ctrl + S**: こまめに保存
- **Ctrl + →**: 次のシーンへ
- **Ctrl + ←**: 前のシーンへ

---

## Part 5: プロジェクトの保存とテンプレート化

### Step 5-1: プロジェクトを保存

**Ctrl + S** を押してプロジェクトを保存します。

```
ステータスバー: 保存しました: E:\works\tutorial\チュートリアルプロジェクト.pfft
```

### Step 5-2: テンプレートとして保存（オプション）

この構成を再利用したい場合、テンプレートとして保存できます。

1. メニュー → **ファイル** → **テンプレートとして保存**
2. テンプレート名: **チュートリアル基本構成**
3. タイプ: **◉ 構成テンプレート** を選択
   - プロンプト内容は保存しない（構造だけ）
4. 説明: **2シーン構成、品質タグ統一**
5. [保存] ボタンをクリック

**確認:**
```
保存完了ダイアログ:
テンプレート「チュートリアル基本構成」を保存しました。

タイプ: structure
シーン数: 2
```

### Step 5-3: テンプレートの確認

次回プロジェクト作成時に使えます。

1. メニュー → **ファイル** → **テンプレートから作成**
2. **✨ チュートリアル基本構成** が表示される

---

## Part 6: プロンプトの出力

### Step 6-1: 出力設定

メニュー → **ファイル** → **プロンプト出力** (または **Ctrl + E**)

**出力設定ダイアログ:**
```
┌─────────────────────────┐
│ 出力対象: 全2シーン      │
│                          │
│ 出力先:                  │
│ ◉ ファイル               │
│   ファイル名:            │
│   [tutorial_prompts.txt] │
│   保存先:                │
│   [E:\works\tutorial\]   │
│   [参照...]              │
│                          │
│ オプション:              │
│ ☑ 完成済みシーンのみ    │ ← チェック
│ ☐ シーン番号をコメント  │
│                          │
│ [キャンセル] [出力]     │
└─────────────────────────┘
```

### Step 6-2: 出力実行

[出力] ボタンをクリックします。

**確認:**
```
ステータスバー: プロンプトを出力しました: E:\works\tutorial\tutorial_prompts.txt
```

### Step 6-3: 出力ファイルの確認

生成された `tutorial_prompts.txt` を開きます。

**内容:**
```
school infirmary, beds with curtain dividers, BREAK, __キャラ/MAID__, BREAK, sitting on chair, BREAK, masterpiece, best quality, amazing quality
classroom interior, desks in rows, BREAK, __キャラ/MAID__, BREAK, standing, BREAK, masterpiece, best quality
```

**確認ポイント:**
- 1行 = 1シーン
- カンマ区切り
- BREAK処理済み
- ワイルドカード形式（`__filename__`）がそのまま

---

## Part 7: Stable Diffusionで画像生成

### Step 7-1: Stable Diffusion WebUIを起動

```bash
# Stable Diffusion WebUIのディレクトリに移動
cd E:\EasyReforge

# WebUIを起動
webui-user.bat
```

ブラウザで http://127.0.0.1:7860 にアクセスします。

### Step 7-2: Prompts from fileを設定

1. **Script** ドロップダウンをクリック
2. **Prompts from file or textbox** を選択

**設定項目が表示されます:**
```
Prompts from file or textbox

File or text: [参照...]
Iterate seed every line: Yes
Use same random seed for all lines: No
...
```

### Step 7-3: プロンプトファイルを読み込み

1. **[参照...]** ボタンをクリック
2. `E:\works\tutorial\tutorial_prompts.txt` を選択
3. [開く] ボタンをクリック

**確認:**
```
File or text: E:\works\tutorial\tutorial_prompts.txt
```

### Step 7-4: 生成設定

基本的な設定例:

```
Sampling method: DPM++ 2M Karras
Sampling steps: 20
Width: 512
Height: 768
Batch count: 1
Batch size: 1
CFG Scale: 7
Seed: -1 (ランダム)
```

### Step 7-5: 画像生成を実行

**[Generate]** ボタンをクリックします。

**処理:**
```
Progress: 1/2
現在: school infirmary, beds with curtain dividers, ...

Progress: 2/2
現在: classroom interior, desks in rows, ...
```

**完了:**
```
画像が2枚生成されました！
outputs/txt2img-images/2025-10-14/
  ├ 00001-xxxxx.png  ← シーン1: 保健室
  └ 00002-xxxxx.png  ← シーン2: 教室
```

### Step 7-6: 結果の確認

生成された画像を確認します。

**確認ポイント:**
- 保健室の背景になっているか
- メイド服のキャラクターが描かれているか
- ポーズは意図通りか

**ワイルドカードの展開:**
- `__キャラ/MAID__` が自動的に展開されている
- Dynamic Prompts拡張がファイルからランダムに選択

---

## Part 8: さらなる応用

### 自作プロンプトを保存する

よく使うプロンプトの組み合わせを保存できます。

1. シーン編集パネルでブロックを選択（複数可）
2. **[💾 ライブラリに保存]** ボタンをクリック
3. 日本語ラベル: **保健室メイドシーン**
4. カテゴリ: **自作**
5. [保存] ボタンをクリック

**次回から:**
```
左パネル → 📂 自作
  ├ ✨ 保健室メイドシーン [+] ← ダブルクリックで即挿入
```

### 30シーンに拡張する

チュートリアルで作った2シーンを、30シーンに拡張します。

**効率的な方法:**

1. **テンプレートを活用**
   - 既存の2シーンをテンプレート化
   - 30シーン分のプロジェクトを作成
   - 各シーンに内容を埋める

2. **共通プロンプトの設定**
   - メニュー → ツール → 設定
   - 共通プロンプトタブ
   - 品質タグを設定 → 新規シーン作成時に自動挿入

3. **検索とショートカットを活用**
   - 検索で素早くプロンプトを探す
   - Ctrl+→ で高速シーン移動
   - Ctrl+S でこまめに保存

### バリエーションを作る

同じ構成で異なるキャラクターやシチュエーションを試す。

**方法:**
1. プロジェクトを「名前を付けて保存」で複製
2. キャラクターのワイルドカードを変更
3. 背景を変更
4. 新しいプロンプトファイルを出力
5. Stable Diffusionで生成

---

## まとめ

### このチュートリアルで学んだこと

✅ **Part 1**: Pfft_makerのインストールと起動
✅ **Part 2**: ライブラリの読み込み
✅ **Part 3**: 最初のシーンの作成
✅ **Part 4**: 2つ目のシーンの作成
✅ **Part 5**: プロジェクトとテンプレートの保存
✅ **Part 6**: プロンプトの出力
✅ **Part 7**: Stable Diffusionでの画像生成
✅ **Part 8**: さらなる応用

### 次のステップ

- 📚 [ユーザーガイド](USER_GUIDE.md)で詳細機能を学ぶ
- 🎨 30シーン分のCG集を作成してみる
- 🔄 テンプレート機能を活用して効率化
- 💾 自作プロンプトライブラリを充実させる
- 🤖 AI自動ラベル生成を試す（オプション）

### トラブル時は

- [ユーザーガイド - トラブルシューティング](USER_GUIDE.md#トラブルシューティング)
- ログファイルを確認: `logs/pfft_maker_YYYYMMDD.log`
- Issue報告: https://github.com/anthropics/pfft_maker/issues

---

## 練習課題

チュートリアルの内容を定着させるため、以下の課題に挑戦してみましょう。

### 課題1: 5シーンのプロジェクトを作成

**テーマ:** 学園生活

**シーン構成:**
1. 朝の登校
2. 教室での授業
3. 昼休みの食堂
4. 放課後の部活動
5. 夕方の下校

**条件:**
- 各シーンに背景・キャラ・ポーズを含める
- BREAKで適切に区切る
- 品質タグを追加
- 全シーンを完成にする

### 課題2: テンプレートを作成

課題1で作成したプロジェクトをテンプレート化します。

**要件:**
- テンプレート名: **学園生活5シーン**
- タイプ: 構成テンプレート
- 説明を記入

### 課題3: バリエーションを作成

課題1のプロジェクトを複製し、異なるバリエーションを作成します。

**変更点:**
- キャラクターを変更
- 時間帯を変更（朝 → 夜）
- 季節を変更（春 → 冬）

**ヒント:**
- 「名前を付けて保存」で複製
- 検索機能を活用
- ワイルドカードを使ってバリエーション増加

---

**チュートリアル完了！お疲れ様でした！** 🎉

これでPfft_makerの基本的な使い方をマスターしました。
さらに詳しい機能については [ユーザーガイド](USER_GUIDE.md) をご覧ください。
